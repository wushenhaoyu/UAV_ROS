# nav2_params.yaml

# Map server
map_server:
  use_sim_time: false
  yaml_filename: "path_to_your_map.yaml"  # This should be replaced with the actual path to the map generated by Cartographer

# Localization
localization:
  amcl:
    use_sim_time: false
    global_frame: map
    transform_tolerance: 0.2
    update_min_d: 0.1
    update_min_a: 0.1
    resample_threshold: 0.5
    initial_pose:
      x: 0.0
      y: 0.0
      theta: 0.0
    min_particles: 100
    max_particles: 2000
    laser_likelihood_max_dist: 2.0
    tf_broadcast: true

# Global planner
planner:
  plugin: nav2_bt_navigator/BtNavigator
  bt_xml_file: "nav2_tasks.xml"
  global_frame: map
  robot_base_frame: base_link
  goal_checker_plugins: ["SimpleGoalChecker"]
  controller_plugins: ["FollowPath"]
  planner_frequency: 2.0
  planner_patience: 5.0
  controller_frequency: 10.0
  controller_patience: 15.0
  recovery_behavior_enabled: true
  recovery_wait_duration: 1.0
  odom_topic: /odometry/filtered

# Local planner
controller:
  plugin: nav2_controller/ControllerServer
  simple_controller_plugin: "DWAController"
  cmd_vel_topic: cmd_vel
  odom_topic: /odometry/filtered
  base_frame_id: base_link
  goal_frame_id: map
  transform_tolerance: 0.1
  update_frequency: 10.0
  min_x_velocity_threshold: 0.01
  min_theta_velocity_threshold: 0.01
  linear_x_range_samples: 3
  linear_y_range_samples: 1
  angular_z_range_samples: 12
  linear_x_min: -0.5
  linear_x_max: 0.5
  linear_y_offset: 0.0
  angular_z_min: -1.0
  angular_z_max: 1.0
  angular_z_offset: 0.0
  linear_xy_gain: 1.0
  angular_z_gain: 1.0
  linear_x_scale_cost: 1.0
  linear_y_scale_cost: 0.5
  angular_z_scale_cost: 1.0
  oscillation_reset_distance: 0.05
  path_distance_bias: 32.0
  goal_distance_bias: 24.0
  meter_scoring_enabled: true
  meter_scoring_range: 10.0
  path_scoring_enabled: true
  path_scoring_range: 8.0
  occdist_scale: 0.01
  free_space_scale: 0.0
  critical_obstacle_cost: 25.0
  slow_robot_max_cost: 20.0
  slow_robot_weight: 5.0
  prune_plan: true
  min_obstacle_distance: 0.25
  min_plan_frequency: 5.0
  max_plan_retries: 5
  min_global_plan_length: 0.1
  max_global_plan_lookahead_dist: 2.0
  min_local_plan_lookahead_dist: 0.5
  max_global_plan_violation_dist: 0.5
  min_global_plan_violation_theta: 0.087
  min_global_plan_violation_time: 0.5
  min_global_plan_violation_distance: 0.1
  min_global_plan_violation_angle: 0.087
  min_global_plan_violation_cost: 1.0
  min_global_plan_violation_penalty: 1.0
  min_global_plan_violation_recovery_time: 1.0
  min_global_plan_violation_recovery_distance: 0.1
  min_global_plan_violation_recovery_angle: 0.087
  min_global_plan_violation_recovery_cost: 1.0
  min_global_plan_violation_recovery_penalty: 1.0

# Recovery behaviors
recovery:
  plugin: nav2_controller/ControllerServer
  simple_recovery_plugin: "RotateRecovery"
  rotate_recovery:
    enabled: true
    min_rotation_angle: 1.57
    max_rotation_angle: 6.28
    angular_speed: 1.0
    rotation_timeout: 10.0
    min_recovery_time: 1.0
    max_recovery_attempts: 3

# Costmap
costmap:
  global_costmap:
    plugins: ["static_layer", "obstacle_layer", "inflation_layer"]
    static_layer:
      plugin: "nav2_costmap_2d::StaticLayer"
    obstacle_layer:
      plugin: "nav2_costmap_2d::ObstacleLayer"
      observation_sources: scan
      scan:
        topic: scan
        marking: true
        clearing: true
    inflation_layer:
      plugin: "nav2_costmap_2d::InflationLayer"
      inflation_radius: 0.5
  local_costmap:
    plugins: ["obstacle_layer", "inflation_layer"]
    obstacle_layer:
      plugin: "nav2_costmap_2d::ObstacleLayer"
      observation_sources: scan
      scan:
        topic: scan
        marking: true
        clearing: true
    inflation_layer:
      plugin: "nav2_costmap_2d::InflationLayer"
      inflation_radius: 0.5

# Behavior tree
behavior_tree:
  plugin: nav2_bt_navigator/BtNavigator
  bt_xml_file: "nav2_tasks.xml"